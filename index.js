

const express = require("express");
const { google } = require("googleapis");
const fs = require("fs");
const cors = require("cors");
const dotenv = require("dotenv")
dotenv.config();
const app = express();

// Option 1: Allow all origins (development only)
app.use(cors());



app.use(express.json());
// const encoded = `
// ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiZHItbWFuZ2Fscy1jbGluaWMiLAogICJwcml2YXRlX2tleV9pZCI6ICIzMDFiNDZhODIzMGUxNTMyMmIxYTJlMTUzNDQ4Y2NkNzJlYTdmZTJiIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdkFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLWXdnZ1NpQWdFQUFvSUJBUUMwMU1YOXpsK2VnYzlJXG5JNTE1NURIKzhSbjY2eVMwZHhnVWU4TWVWRlpnM0tua3R3ZjdZRHFQTUpFeU52bDFGY1dvQ2ZCVzU4ZFhTeUtrXG5xanJXUFRyQThLU1pwdGorWEpRbGNIK2YraVY1OEVHS01jSHhZZllwQTRXZFJiRXZWU2Z5bkRKbWtzMFdsSlYrXG4xWjc5Qkh5SDhHdTFHRnI1QzAzSUZtM1dYNSswbWw4NVRYOVRzbWhFKy9TTnJ3Mmx3cjJTcnVLTUtoMC9VSmdxXG5CWk9tbU9EWk0zcDAvSlJhNjIyMjhuSENNNVpTZVlzVzVDTWtyS3lBUnVSNmFEQVMzTTJGbHllTFpDb2ZwQUZVXG5EbmxQNnJ0NStBUEVuZmYvT1hML09teldhQjAyNU1Zc2lhSXl3bDFPQWswQlRjN2xsVm9lQ2dmVDg3Z2s1TUh0XG5ORk11MG9sdEFnTUJBQUVDZ2dFQVRQR1VaWkNnb3lOOC9hY1o1TG15aEZZMnhjdTBUSTI0VTA3dUVVTzFsWFdQXG5YT0I4cHZ1bEx6UnRNNzZzbXFOdS9UZHRhcTBvNXYzemVibHRXNmVtRGw3V3l3SnhwcG5oOTZSTXlkZDRodEF5XG5Nd2xGQ3Q2eURYV1FMd0Z1aVVOa3doaXdZWERwajBnZDdHQWRURy9TUlUySnB2NzhCcWhHcW5MUXZiem1pY1BFXG43L21wMUZ3UGFsYkRxeUMvaGE1S0c3SmErNldCS1E2VC9TK0hWNTNVTVQxcFhBV0VkSTRHdDc1WERueGRXRmVZXG5MdloyQVd4cWFsTVRtblFOeDZpTGtlVi8xWTd0VUpScnNQWkhkcXlONHdHKzE5aUV4NFhJZkxVT2tWbWQ3dzhhXG4rRlBRbVFxWmc2Y1FESzBxYS8yaXdVYWJPYWY5amgvSGc2ZjlMMW9IaVFLQmdRRDRWaDUwNkZyRkZYY1lWbmg0XG53UkFwd0lXUFM1eGxyS1RMblBvSTNjM1phSWpxVStuenpHUmlQZlA5RTB5N09vcEdSa1JiWkNjMU5QVU5XUmRwXG52anFQR0RTYVkzZ0VRUE5IellHOEo3M2UxdStjcnZETnVMbHp0OVllL2UxaUV3Ny9USXRvREh5VFdkaXNCNlk5XG44NlpwcVpwYmVmRkFLMUZLOGFyRCtIbk9Yd0tCZ1FDNmFWdEYyaGY3MkR0TzRMYVZ0ek82RlpPcHJNUUZHcUg4XG5KTG12c2wwOE4zVnNISFRMMU9ySkdnWWZoUkJIVW13bTRkdlVGMkYvMHpYTitQc1E0SEljRzRZeENDSXN2Y0VMXG5iL0xEbkc3OXVmZnFsZ3BTQm9JelNpRzNvb2pnQ2M4SnpkaUJtYis3NTlzVjRQTFZnc0tjT2h4aXRKSVhhb2ttXG5SbThxN3ZmanN3S0JnRVVHYXVERDFMY0RDRjlUYVpqbTBMOUtLOVZ3aHNBY0JKSXp4NnUvT3dBNjloTnJ6NU5jXG5OR3E2SFo4eVJobWtZOXEwblR0cDB4d081QzRablZCZTk1ZmVlb0NQTlVTNWFPV0VVWk1pMkx1ZnNtb3lsZXdZXG5kRE9kM1g0dnhsT0VTSjdkZjhJajlseGVsTUw4UFZEcThFNWVQZkUvSzdkU1V2NHB2ZlZLazFDeEFvR0FPeFZSXG5uSjQzbzljeFZScmNSQy9BOFdZTlcyWXE2d001L0ZVWGxaeU8rSnNMV0t6Y1NBN0FLK1ZYczMzVlh3Vzh5Y1lrXG5pdUN1UW5tTFFERitRaWNoZzg4bGhUenl1QU9jd0NkSFpzQ2FYVWtvVHU0bmIwQW8zR0RPdHdtSklKbDdTYnc0XG50enNvRGtLNnFnQ1dkeDN1Mk4yQ1NiYTU1em9aSmt5RXg3TGVWd2tDZ1lCS2ZsZDZScHFWUGN1dVRIdU5lZWFGXG52VE9yMWIya3NObmk0dG1tbWNiOFordTBndDhYdTZkRWFEcXhMR1dFU1BxNnNIZzV6cTRFT1pIM1NJanIrYVBzXG5CUjJjRlVadkQ2VGpmUnlQRktvK0pWM3FzNzdIYU5nT3J1RW5tYklmbUFheklURDJreno4QnE1VmlJUUl4N21mXG4rdkdIZ25kMlQvenhLVVdMY0VvMjhRPT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJkci1tYW5nYWxzLWNsaW5pY0Bkci1tYW5nYWxzLWNsaW5pYy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTYzMjIzNzc4Mjg4NzE5NjY4MDYiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2RyLW1hbmdhbHMtY2xpbmljJTQwZHItbWFuZ2Fscy1jbGluaWMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJ1bml2ZXJzZV9kb21haW4iOiAiZ29vZ2xlYXBpcy5jb20iCn0K
// `.trim();

// const credentials = JSON.parse(
//   Buffer.from(encoded, "base64").toString("utf8")
// );
// const auth = new google.auth.GoogleAuth({
//   credentials: credentials,
//   scopes: ["https://www.googleapis.com/auth/spreadsheets"],
// });
// const sheets = google.sheets({ version: "v4", auth });

//comment test
app.get("/", (req,res)=>{
  res.status(200).send("Server is Running");
})

// Replace this with your sheet ID
const SHEET_ID = "1hQUb0R_bPvzyyI7jDiceSVVTyLGqovLcJgNHS5QiJFI";
app.post("/add-entry", async (req, res) => {

const encoded = `
ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAidmlicmFudC1ncmFtbWFyLTQ2NTMxOS1tMyIsCiAgInByaXZhdGVfa2V5X2lkIjogImJjZDQ3YTI0ZDZiMmQwMGJiMWVmYjIxODNhZjVmNjM2YTU2ZTM3YmYiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQytWOVMyZXBKU3plYjBcbldXNFBtTGdsOE9mZWpXZXBnN0JZVmY1NERDRys2UUFveS9qSEdqNUhhS0xVUWFJaWgyVEZnaVdzSnArQVpjUi9cbmZCQVZ2ZEpoUFZoRW9ZTnRKcmhBZnJiMFJ5TXR4OWNUVmg3VXhSbFpsb3pzdEZLNWVncVFFL3VYQzNScW0wVDZcbmFobEJBd0prdFlIWU1Dck5LODN1U1BGMnpOVlFJV1MwQ09rd3lwaENNV2laRXczcmJxb0xPeFM5Yk9TUHQybkVcbnV3OXU1M2t4bHdRa2V4TGZIeVVHazVSSUdwbG9iQkVlRngzaERiYk53S0t1ZmZqcDVtT085T3UzQm5mdG11c3FcbkpQVG9McER3U20rdE5JK1FYWUZFQUNpSStKdko2V3YyamRYVXRQWHpwbFhYTUpmS3dnUGdPdmZLcHBVUklqcXhcbk9ZbmlITGl2QWdNQkFBRUNnZ0VBQlM3T0QzUHg5UWcvUUNzSk9LcC9aU1VVb3pZMWV1T25reGd3V0NONGJjTFpcbmFzTDNFTERSdms4R2xBSC9nTEl3RjhLdDlPeU9Ua2czSEFPTVNwTkRIYnUyWWhRRnlKeVR5c25JZ0lsSlYyOUlcbkYzSXlYN2ZJTTJ6S2hJMTZiU3Q2Q3lkSUkvby9Yc0hBbEpMOEFnMnJiSU9XdUFURHZaZHlRWWxCN2VxdzZrQWFcbmVaNVZBamt6Y3ZkdXhxY2MrelJFRTZ2QWRFZnkzM1p1RGwwZGxEVUJ6bzNtWWtZRGpsQm42NkNsUm14WEdPZHhcbjZBYjAyK21rcmFpUmVVT3k5L2lwZ1l1dmhHeGlsWTcwSnVuWFJrTXRnamtsQ0wvMW1heFRuZGFDTE1wYU5vdHJcbjZOc1hLOXBPVzJ1WDc5UG42ZTBlUWRwWnlFVzN4dzh6blA1KzA3SlI3UUtCZ1FEc2N1MHVPcDFaZUFhTytPVU9cbjZEeDJrVGFMMGQwWDhvNWZudFJ4R0xHdVpBOFZJOG11d0RoZzR0cHlqYUE5Yzc5ZmlOeE1sS2lrZnZTL2dSZWhcbjhnRGcyNkJqOE42UHFyWEZnZHgyeGJSZUxVYVlLU3llRllSMWV2SHd2ajdQMDRaL2VCSVNhbW1SQXFCM3FWaDNcbk1UcTE3cHFGU3BlNkNQLzFmczlDS1RzR3V3S0JnUURPRlBONDVEYm5abWpjVnRFbzdhUmFYTmxEc25yQ3VtSFlcbm5QSXMwTWhDcHlCZHVpQmhScmRrTzc0cXIwV1FXcjBUTmJUcWtOTGdEZXNTQ2t5eStNOXIzR2MrRjh3WDViYkhcbnRqTVhNR1pLWCsrQmROTlEzREc3cEFhS2hpWXRxL3YvNUkyeEQ0K1VDT3Bxa0VkWUVmVGhOUWxMbXdjc1ozYmlcbnIydytGVDlJblFLQmdRRExRcGlsenZtSStlY1piTmpzRWJRNGNPaWxGWW1zbG5UUnVtWUJ1eXF6TVl6TnJYQW9cbjYxRUw2TGZGRmY2VUZUYUVWOUNaZklua3JzYVRBZFJoQVByRVVjajFZUkRTQy93cWgxSVFRRENuYk9CczJhaGpcblZUZ0REZWVCL3VsY0d3aFo5OHdCVEx6blRZeklrU2xkZlZKdEoycHAvdytqZXkwZHl4ODhUdGxSRlFLQmdCcUpcbldoeXNEbUhYcnhNSVh1Q05VVWVOZ3pDVGIvbFpOTFpHNTJ4YjZoMmpGYWpjQ2NWYzdNcU1ZdDF1T2wvdlB6K1Vcbi85bmdramJscytwYnh5cVluV1QvT1pBbVVsS1ZjdWJla0UraEhOcmc1WjllNHNNYng0K28vR3FrQVpDSi8rWWdcbmtScEdyYTliUW93OFRlT0tWR1VYaGozbEZaUmpNa3pZVi9EYW5ZNkZBb0dCQUk3aFBSM294V1RsYk91Tzg0dWxcbkFjYyt6NXZZTjUwSU5kK3MvR0lTMTNJRlZSL0dPWEVNK3JxNTE4OXVpY1pKOUlKaW5UN1g0dHFDWklwcU1LY2VcbkNSd3JmLzdFaThRVDFueDdQMHN4Y3d3dGJjR01pZ2RtdWpsMzNJRFE5S3A2bzJmOXhhRzVSbmxqclhIeW8rWTdcbjNha3RVeExmZ25JZm5tbGR5UStzL0Qyd1xuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImhpLTg0N0B2aWJyYW50LWdyYW1tYXItNDY1MzE5LW0zLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwNDk2NDE2NzQ2NzQ1MTgyNjU5NSIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvaGktODQ3JTQwdmlicmFudC1ncmFtbWFyLTQ2NTMxOS1tMy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgInVuaXZlcnNlX2RvbWFpbiI6ICJnb29nbGVhcGlzLmNvbSIKfQo=`.trim();

const credentials = JSON.parse(
  Buffer.from(encoded, "base64").toString("utf8")
);
const auth = new google.auth.GoogleAuth({
  credentials: credentials,
  scopes: ["https://www.googleapis.com/auth/spreadsheets"],
});
const sheets = google.sheets({ version: "v4", auth });

  try {
    const { name, email, phone, department, message } = req.body;
    if (!name || !email || !message)
      return res.status(400).json({ error: "Missing fields" });
    await sheets.spreadsheets.values.append({
      spreadsheetId: SHEET_ID,
      range: "Sheet1!A:E", // target columns
      valueInputOption: "USER_ENTERED",
      requestBody: {
        values: [[name, email, phone,department, message]],
      },
    });
    res.status(200).json({ success: true, message: "Row added to Google Sheet" });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Failed to add entry" });
  }
});
app.listen(3000, () => console.log("Server running on port 3000"));
module.exports = app;













