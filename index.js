

const express = require("express");
const { google } = require("googleapis");
const fs = require("fs");
const cors = require("cors");
const dotenv = require("dotenv")
dotenv.config();
const app = express();

// Option 1: Allow all origins (development only)
app.use(cors());



app.use(express.json());
// const encoded = `
// ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiZHItbWFuZ2Fscy1jbGluaWMiLAogICJwcml2YXRlX2tleV9pZCI6ICIzMDFiNDZhODIzMGUxNTMyMmIxYTJlMTUzNDQ4Y2NkNzJlYTdmZTJiIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdkFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLWXdnZ1NpQWdFQUFvSUJBUUMwMU1YOXpsK2VnYzlJXG5JNTE1NURIKzhSbjY2eVMwZHhnVWU4TWVWRlpnM0tua3R3ZjdZRHFQTUpFeU52bDFGY1dvQ2ZCVzU4ZFhTeUtrXG5xanJXUFRyQThLU1pwdGorWEpRbGNIK2YraVY1OEVHS01jSHhZZllwQTRXZFJiRXZWU2Z5bkRKbWtzMFdsSlYrXG4xWjc5Qkh5SDhHdTFHRnI1QzAzSUZtM1dYNSswbWw4NVRYOVRzbWhFKy9TTnJ3Mmx3cjJTcnVLTUtoMC9VSmdxXG5CWk9tbU9EWk0zcDAvSlJhNjIyMjhuSENNNVpTZVlzVzVDTWtyS3lBUnVSNmFEQVMzTTJGbHllTFpDb2ZwQUZVXG5EbmxQNnJ0NStBUEVuZmYvT1hML09teldhQjAyNU1Zc2lhSXl3bDFPQWswQlRjN2xsVm9lQ2dmVDg3Z2s1TUh0XG5ORk11MG9sdEFnTUJBQUVDZ2dFQVRQR1VaWkNnb3lOOC9hY1o1TG15aEZZMnhjdTBUSTI0VTA3dUVVTzFsWFdQXG5YT0I4cHZ1bEx6UnRNNzZzbXFOdS9UZHRhcTBvNXYzemVibHRXNmVtRGw3V3l3SnhwcG5oOTZSTXlkZDRodEF5XG5Nd2xGQ3Q2eURYV1FMd0Z1aVVOa3doaXdZWERwajBnZDdHQWRURy9TUlUySnB2NzhCcWhHcW5MUXZiem1pY1BFXG43L21wMUZ3UGFsYkRxeUMvaGE1S0c3SmErNldCS1E2VC9TK0hWNTNVTVQxcFhBV0VkSTRHdDc1WERueGRXRmVZXG5MdloyQVd4cWFsTVRtblFOeDZpTGtlVi8xWTd0VUpScnNQWkhkcXlONHdHKzE5aUV4NFhJZkxVT2tWbWQ3dzhhXG4rRlBRbVFxWmc2Y1FESzBxYS8yaXdVYWJPYWY5amgvSGc2ZjlMMW9IaVFLQmdRRDRWaDUwNkZyRkZYY1lWbmg0XG53UkFwd0lXUFM1eGxyS1RMblBvSTNjM1phSWpxVStuenpHUmlQZlA5RTB5N09vcEdSa1JiWkNjMU5QVU5XUmRwXG52anFQR0RTYVkzZ0VRUE5IellHOEo3M2UxdStjcnZETnVMbHp0OVllL2UxaUV3Ny9USXRvREh5VFdkaXNCNlk5XG44NlpwcVpwYmVmRkFLMUZLOGFyRCtIbk9Yd0tCZ1FDNmFWdEYyaGY3MkR0TzRMYVZ0ek82RlpPcHJNUUZHcUg4XG5KTG12c2wwOE4zVnNISFRMMU9ySkdnWWZoUkJIVW13bTRkdlVGMkYvMHpYTitQc1E0SEljRzRZeENDSXN2Y0VMXG5iL0xEbkc3OXVmZnFsZ3BTQm9JelNpRzNvb2pnQ2M4SnpkaUJtYis3NTlzVjRQTFZnc0tjT2h4aXRKSVhhb2ttXG5SbThxN3ZmanN3S0JnRVVHYXVERDFMY0RDRjlUYVpqbTBMOUtLOVZ3aHNBY0JKSXp4NnUvT3dBNjloTnJ6NU5jXG5OR3E2SFo4eVJobWtZOXEwblR0cDB4d081QzRablZCZTk1ZmVlb0NQTlVTNWFPV0VVWk1pMkx1ZnNtb3lsZXdZXG5kRE9kM1g0dnhsT0VTSjdkZjhJajlseGVsTUw4UFZEcThFNWVQZkUvSzdkU1V2NHB2ZlZLazFDeEFvR0FPeFZSXG5uSjQzbzljeFZScmNSQy9BOFdZTlcyWXE2d001L0ZVWGxaeU8rSnNMV0t6Y1NBN0FLK1ZYczMzVlh3Vzh5Y1lrXG5pdUN1UW5tTFFERitRaWNoZzg4bGhUenl1QU9jd0NkSFpzQ2FYVWtvVHU0bmIwQW8zR0RPdHdtSklKbDdTYnc0XG50enNvRGtLNnFnQ1dkeDN1Mk4yQ1NiYTU1em9aSmt5RXg3TGVWd2tDZ1lCS2ZsZDZScHFWUGN1dVRIdU5lZWFGXG52VE9yMWIya3NObmk0dG1tbWNiOFordTBndDhYdTZkRWFEcXhMR1dFU1BxNnNIZzV6cTRFT1pIM1NJanIrYVBzXG5CUjJjRlVadkQ2VGpmUnlQRktvK0pWM3FzNzdIYU5nT3J1RW5tYklmbUFheklURDJreno4QnE1VmlJUUl4N21mXG4rdkdIZ25kMlQvenhLVVdMY0VvMjhRPT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJkci1tYW5nYWxzLWNsaW5pY0Bkci1tYW5nYWxzLWNsaW5pYy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTYzMjIzNzc4Mjg4NzE5NjY4MDYiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2RyLW1hbmdhbHMtY2xpbmljJTQwZHItbWFuZ2Fscy1jbGluaWMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJ1bml2ZXJzZV9kb21haW4iOiAiZ29vZ2xlYXBpcy5jb20iCn0K
// `.trim();

// const credentials = JSON.parse(
//   Buffer.from(encoded, "base64").toString("utf8")
// );
// const auth = new google.auth.GoogleAuth({
//   credentials: credentials,
//   scopes: ["https://www.googleapis.com/auth/spreadsheets"],
// });
// const sheets = google.sheets({ version: "v4", auth });

//comment test
app.get("/", (req,res)=>{
  res.status(200).send("Server is Running");
})

// Replace this with your sheet ID
const SHEET_ID = "1hQUb0R_bPvzyyI7jDiceSVVTyLGqovLcJgNHS5QiJFI";
app.post("/add-entry", async (req, res) => {

const encoded = `
ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiZHItbWFuZ2Fscy1jbGluaWMiLAogICJwcml2YXRlX2tleV9pZCI6ICIzMDFiNDZhODIzMGUxNTMyMmIxYTJlMTUzNDQ4Y2NkNzJlYTdmZTJiIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdkFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLWXdnZ1NpQWdFQUFvSUJBUUMwMU1YOXpsK2VnYzlJXG5JNTE1NURIKzhSbjY2eVMwZHhnVWU4TWVWRlpnM0tua3R3ZjdZRHFQTUpFeU52bDFGY1dvQ2ZCVzU4ZFhTeUtrXG5xanJXUFRyQThLU1pwdGorWEpRbGNIK2YraVY1OEVHS01jSHhZZllwQTRXZFJiRXZWU2Z5bkRKbWtzMFdsSlYrXG4xWjc5Qkh5SDhHdTFHRnI1QzAzSUZtM1dYNSswbWw4NVRYOVRzbWhFKy9TTnJ3Mmx3cjJTcnVLTUtoMC9VSmdxXG5CWk9tbU9EWk0zcDAvSlJhNjIyMjhuSENNNVpTZVlzVzVDTWtyS3lBUnVSNmFEQVMzTTJGbHllTFpDb2ZwQUZVXG5EbmxQNnJ0NStBUEVuZmYvT1hML09teldhQjAyNU1Zc2lhSXl3bDFPQWswQlRjN2xsVm9lQ2dmVDg3Z2s1TUh0XG5ORk11MG9sdEFnTUJBQUVDZ2dFQVRQR1VaWkNnb3lOOC9hY1o1TG15aEZZMnhjdTBUSTI0VTA3dUVVTzFsWFdQXG5YT0I4cHZ1bEx6UnRNNzZzbXFOdS9UZHRhcTBvNXYzemVibHRXNmVtRGw3V3l3SnhwcG5oOTZSTXlkZDRodEF5XG5Nd2xGQ3Q2eURYV1FMd0Z1aVVOa3doaXdZWERwajBnZDdHQWRURy9TUlUySnB2NzhCcWhHcW5MUXZiem1pY1BFXG43L21wMUZ3UGFsYkRxeUMvaGE1S0c3SmErNldCS1E2VC9TK0hWNTNVTVQxcFhBV0VkSTRHdDc1WERueGRXRmVZXG5MdloyQVd4cWFsTVRtblFOeDZpTGtlVi8xWTd0VUpScnNQWkhkcXlONHdHKzE5aUV4NFhJZkxVT2tWbWQ3dzhhXG4rRlBRbVFxWmc2Y1FESzBxYS8yaXdVYWJPYWY5amgvSGc2ZjlMMW9IaVFLQmdRRDRWaDUwNkZyRkZYY1lWbmg0XG53UkFwd0lXUFM1eGxyS1RMblBvSTNjM1phSWpxVStuenpHUmlQZlA5RTB5N09vcEdSa1JiWkNjMU5QVU5XUmRwXG52anFQR0RTYVkzZ0VRUE5IellHOEo3M2UxdStjcnZETnVMbHp0OVllL2UxaUV3Ny9USXRvREh5VFdkaXNCNlk5XG44NlpwcVpwYmVmRkFLMUZLOGFyRCtIbk9Yd0tCZ1FDNmFWdEYyaGY3MkR0TzRMYVZ0ek82RlpPcHJNUUZHcUg4XG5KTG12c2wwOE4zVnNISFRMMU9ySkdnWWZoUkJIVW13bTRkdlVGMkYvMHpYTitQc1E0SEljRzRZeENDSXN2Y0VMXG5iL0xEbkc3OXVmZnFsZ3BTQm9JelNpRzNvb2pnQ2M4SnpkaUJtYis3NTlzVjRQTFZnc0tjT2h4aXRKSVhhb2ttXG5SbThxN3ZmanN3S0JnRVVHYXVERDFMY0RDRjlUYVpqbTBMOUtLOVZ3aHNBY0JKSXp4NnUvT3dBNjloTnJ6NU5jXG5OR3E2SFo4eVJobWtZOXEwblR0cDB4d081QzRablZCZTk1ZmVlb0NQTlVTNWFPV0VVWk1pMkx1ZnNtb3lsZXdZXG5kRE9kM1g0dnhsT0VTSjdkZjhJajlseGVsTUw4UFZEcThFNWVQZkUvSzdkU1V2NHB2ZlZLazFDeEFvR0FPeFZSXG5uSjQzbzljeFZScmNSQy9BOFdZTlcyWXE2d001L0ZVWGxaeU8rSnNMV0t6Y1NBN0FLK1ZYczMzVlh3Vzh5Y1lrXG5pdUN1UW5tTFFERitRaWNoZzg4bGhUenl1QU9jd0NkSFpzQ2FYVWtvVHU0bmIwQW8zR0RPdHdtSklKbDdTYnc0XG50enNvRGtLNnFnQ1dkeDN1Mk4yQ1NiYTU1em9aSmt5RXg3TGVWd2tDZ1lCS2ZsZDZScHFWUGN1dVRIdU5lZWFGXG52VE9yMWIya3NObmk0dG1tbWNiOFordTBndDhYdTZkRWFEcXhMR1dFU1BxNnNIZzV6cTRFT1pIM1NJanIrYVBzXG5CUjJjRlVadkQ2VGpmUnlQRktvK0pWM3FzNzdIYU5nT3J1RW5tYklmbUFheklURDJreno4QnE1VmlJUUl4N21mXG4rdkdIZ25kMlQvenhLVVdMY0VvMjhRPT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJkci1tYW5nYWxzLWNsaW5pY0Bkci1tYW5nYWxzLWNsaW5pYy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTYzMjIzNzc4Mjg4NzE5NjY4MDYiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2RyLW1hbmdhbHMtY2xpbmljJTQwZHItbWFuZ2Fscy1jbGluaWMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJ1bml2ZXJzZV9kb21haW4iOiAiZ29vZ2xlYXBpcy5jb20iCn0K
`.trim();

const credentials = JSON.parse(
  Buffer.from(encoded, "base64").toString("utf8")
);
const auth = new google.auth.GoogleAuth({
  credentials: credentials,
  scopes: ["https://www.googleapis.com/auth/spreadsheets"],
});
const sheets = google.sheets({ version: "v4", auth });

  try {
    const { name, email, phone, department, message } = req.body;
    if (!name || !email || !message)
      return res.status(400).json({ error: "Missing fields" });
    await sheets.spreadsheets.values.append({
      spreadsheetId: SHEET_ID,
      range: "Sheet1!A:E", // target columns
      valueInputOption: "USER_ENTERED",
      requestBody: {
        values: [[name, email, phone,department, message]],
      },
    });
    res.status(200).json({ success: true, message: "Row added to Google Sheet" });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Failed to add entry" });
  }
});
// app.listen(3000, () => console.log("Server running on port 3000"));
module.exports = app;











